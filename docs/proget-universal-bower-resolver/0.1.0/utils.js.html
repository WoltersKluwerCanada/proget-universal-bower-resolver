<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-createError.html">createError</a><ul class='methods'><li data-type='method'><a href="module-createError.html#~createError">createError</a></li></ul></li><li><a href="module-download.html">download</a><ul class='methods'><li data-type='method'><a href="module-download.html#~download">download</a></li></ul></li><li><a href="module-extract.html">extract</a><ul class='methods'><li data-type='method'><a href="module-extract.html#~extract">extract</a></li></ul></li><li><a href="module-index.html">index</a><ul class='methods'><li data-type='method'><a href="module-index.html#~fetch">fetch</a></li><li data-type='method'><a href="module-index.html#~locate">locate</a></li><li data-type='method'><a href="module-index.html#~match">match</a></li><li data-type='method'><a href="module-index.html#~releases">releases</a></li></ul></li><li><a href="module-request.html">request</a><ul class='methods'><li data-type='method'><a href="module-request.html#~communication">communication</a></li><li data-type='method'><a href="module-request.html#~findFeedId">findFeedId</a></li><li data-type='method'><a href="module-request.html#~req">req</a></li></ul></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#~extractRefs">extractRefs</a></li><li data-type='method'><a href="module-utils.html#~extractReleases">extractReleases</a></li><li data-type='method'><a href="module-utils.html#~registryParser">registryParser</a></li><li data-type='method'><a href="module-utils.html#~releases">releases</a></li><li data-type='method'><a href="module-utils.html#~tags">tags</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">utils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

/**
 * Utils module.
 * @module utils
 */

const semver = require("semver");
const createError = require("./createError");

const regex = {
    progetPkgOnly: /^[^\/?]+$/,
    progetGrpPkg: /^[^\/?]+\/[^\/]+$/,
    progetFeedGrpPkg: /^[^\/?]+\/[^\/]+\/[^\/]+$/,
    progetUrl: /.+\?[^\/?]+\/[^\/]+\/[^\/]+$/
};

/**
 * Format a list of tags to be consume by Bower
 *
 * @param {Array} tags - List of semver validated tags
 * @return {Array.&lt;{release: string, target: string, version: string}>}
 */
function releases(tags) {
    if (!tags.length) {
        return [];
    }

    return tags.map((tag) => {
        return {
            release: tag,
            target: tag,
            version: tag
        };
    });
}

/**
 * Validates that the references have semver format
 *
 * @param {Array} refs - List of tags
 * @return {Array}
 */
function tags(refs) {
    return refs.filter((el) => {
        return semver.valid(el);
    });
}

/**
 * Parse the server response in an array of consumable version strings
 *
 * @param {string} response - The server response
 * @return {Array}
 */
function extractRefs(response) {
    let versions = [],
        data = {};

    try {
        data = JSON.parse(response);
    } catch (e) {
        throw e;
    }

    for (let pkg in data) {
        if (data.hasOwnProperty(pkg) &amp;&amp; data[pkg].hasOwnProperty("Version_Text")) {
            versions.push(data[pkg].Version_Text);
        }
    }

    return versions;
}

/**
 * Call the server response parsing
 *
 * @param {string} response - The server response
 * @return {Array.&lt;{release: string, target: string, version: string}>}
 */
function extractReleases(response) {
    return releases(tags(extractRefs(response)));
}

/**
 * Create a URL usable for ProGet from a package name
 *
 * @param {string} source - The package as write in the bower.json file
 * @param {{}} config - The Bower configuration
 * @return {string} - The result url
 */
function registryParser(source, config) {
    let sourceParts = source.split("=");
    source = sourceParts[1] || sourceParts[0];

    if (/^https?:\/\/.*/.test(source)) {
        return source;
    }

    if (config.hasOwnProperty("proget") &amp;&amp; config.proget.hasOwnProperty("server")) {
        let findSource,
            c = config.proget;

        if (regex.progetPkgOnly.test(source)) {
            // Only package provided
            findSource = `${c.server}?${c.feed}/${c.group || "bower"}/${source}`;
        } else if (regex.progetGrpPkg.test(source)) {
            // Group and package provided
            findSource = `${c.server}?${c.feed}/${source}`;
        } else if (regex.progetFeedGrpPkg.test(source)) {
            // Feed, group and package provided
            findSource = `${c.server}?${source}`;
        } else if (regex.progetUrl.test(source)) {
            // Full url provided
            findSource = source;
        }

        if (findSource) {
            return findSource;
        } else {
            throw createError("No source found for " + source, "ESRCNF");
        }
    } else {
        throw createError("No proget.server found in bower configuration", "ESRCNF");
    }
}

module.exports = {
    extractReleases,
    registryParser
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Sun Sep 25 2016 13:00:12 GMT-0400 (Est (heure d’été)) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
